# ğŸš€ Cosnapé¡¹ç›®éƒ¨ç½²å®Œæ•´æŒ‡å—

> æœ¬æŒ‡å—ä¸“ä¸ºå®Œå…¨æ–°æ‰‹ç¼–å†™ï¼Œä»é›¶å¼€å§‹æ•™æ‚¨å¦‚ä½•å°†Cosnapé¡¹ç›®éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨å¹¶è·å¾—å…¬ç½‘è®¿é—®é“¾æ¥ã€‚

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¶æ„è¯´æ˜](#é¡¹ç›®æ¶æ„è¯´æ˜)
2. [éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©](#éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©)
3. [å‡†å¤‡å·¥ä½œ](#å‡†å¤‡å·¥ä½œ)
4. [æ–¹æ¡ˆä¸€ï¼šå…è´¹éƒ¨ç½²ï¼ˆæ¨èæ–°æ‰‹ï¼‰](#æ–¹æ¡ˆä¸€å…è´¹éƒ¨ç½²æ¨èæ–°æ‰‹)
5. [æ–¹æ¡ˆäºŒï¼šäº‘æœåŠ¡å™¨éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰](#æ–¹æ¡ˆäºŒäº‘æœåŠ¡å™¨éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ)
6. [åŸŸåé…ç½®](#åŸŸåé…ç½®)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ğŸ“ é¡¹ç›®æ¶æ„è¯´æ˜

æ‚¨çš„Cosnapé¡¹ç›®åŒ…å«ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š

### ğŸ¨ å‰ç«¯ (project/)
- **æŠ€æœ¯æ ˆ**: React + TypeScript + Vite
- **åŠŸèƒ½**: ç”¨æˆ·ç•Œé¢ï¼Œå›¾ç‰‡ä¸Šä¼ ï¼Œæ•ˆæœé¢„è§ˆ
- **ç«¯å£**: é»˜è®¤5173 (å¼€å‘) / 80 (ç”Ÿäº§)

### âš™ï¸ åç«¯ (runninghub-backend/)
- **æŠ€æœ¯æ ˆ**: Node.js + Express
- **åŠŸèƒ½**: APIæ¥å£ï¼Œå›¾ç‰‡å¤„ç†ï¼Œè°ƒç”¨RunningHub
- **ç«¯å£**: é»˜è®¤3001

### ğŸ”— éƒ¨ç½²æ¶æ„å›¾
```
ç”¨æˆ· â†’ [åŸŸå] â†’ [å‰ç«¯ç½‘ç«™] â†’ [åç«¯API] â†’ [RunningHubæœåŠ¡]
      cosnap.com   (React)     (Node.js)    (AIå¤„ç†)
```

---

## ğŸ¯ éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©

### ğŸ†“ å…è´¹æ–¹æ¡ˆï¼ˆæ¨èæ–°æ‰‹ï¼‰
- **å‰ç«¯**: Vercel/Netlify
- **åç«¯**: Railway/Render
- **æˆæœ¬**: å…è´¹
- **é€‚åˆ**: å­¦ä¹ ã€æµ‹è¯•ã€å°æµé‡

### ğŸ’° ä»˜è´¹æ–¹æ¡ˆï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- **äº‘æœåŠ¡å™¨**: é˜¿é‡Œäº‘/è…¾è®¯äº‘/AWS
- **æˆæœ¬**: 50-200å…ƒ/æœˆ
- **é€‚åˆ**: æ­£å¼è¿è¥ã€å¤§æµé‡

---

## ğŸ›  å‡†å¤‡å·¥ä½œ

### 1. å®‰è£…å¿…è¦å·¥å…·

#### Windowsç”¨æˆ·:
```bash
# ä¸‹è½½å¹¶å®‰è£… Node.js (æ¨èLTSç‰ˆæœ¬)
# è®¿é—®: https://nodejs.org/

# ä¸‹è½½å¹¶å®‰è£… Git
# è®¿é—®: https://git-scm.com/

# éªŒè¯å®‰è£…
node --version
npm --version
git --version
```

### 2. æ³¨å†Œå¿…è¦è´¦å·
- [ ] GitHubè´¦å· (ä»£ç æ‰˜ç®¡)
- [ ] Vercelè´¦å· (å‰ç«¯éƒ¨ç½²)
- [ ] Railwayè´¦å· (åç«¯éƒ¨ç½²)
- [ ] åŸŸåæ³¨å†Œå•†è´¦å· (å¯é€‰)

### 3. ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `runninghub-backend/.env` æ–‡ä»¶ï¼š
```env
# RunningHub APIé…ç½®
RUNNINGHUB_API_KEY=ä½ çš„APIå¯†é’¥
RUNNINGHUB_WEBAPP_ID=ä½ çš„WebApp_ID

# äº‘å­˜å‚¨é…ç½®ï¼ˆå¯é€‰ï¼‰
CLOUD_STORAGE_ACCESS_KEY=äº‘å­˜å‚¨è®¿é—®å¯†é’¥
CLOUD_STORAGE_SECRET_KEY=äº‘å­˜å‚¨å¯†é’¥

# ç«¯å£é…ç½®
PORT=3001
```

---

## ğŸ†“ æ–¹æ¡ˆä¸€ï¼šå…è´¹éƒ¨ç½²ï¼ˆæ¨èæ–°æ‰‹ï¼‰

### ç¬¬ä¸€æ­¥ï¼šä»£ç ä¸Šä¼ åˆ°GitHub

1. **åˆ›å»ºGitHubä»“åº“**
```bash
# åœ¨GitHubç½‘ç«™åˆ›å»ºæ–°ä»“åº“: cosnap-project
# å‹¾é€‰"Add a README file"
```

2. **ä¸Šä¼ æœ¬åœ°ä»£ç **
```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
git init
git add .
git commit -m "Initial commit"
git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/cosnap-project.git
git push -u origin main
```

### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²åç«¯åˆ°Railway

1. **è®¿é—®Railway.appå¹¶ç™»å½•**
2. **ç‚¹å‡»"New Project" â†’ "Deploy from GitHub repo"**
3. **é€‰æ‹©ä½ çš„ä»“åº“ï¼Œè®¾ç½®æ ¹ç›®å½•ä¸º `runninghub-backend`**
4. **æ·»åŠ ç¯å¢ƒå˜é‡**ï¼š
   - `RUNNINGHUB_API_KEY`: ä½ çš„APIå¯†é’¥
   - `RUNNINGHUB_WEBAPP_ID`: ä½ çš„WebApp ID
   - `PORT`: 3001

5. **ç­‰å¾…éƒ¨ç½²å®Œæˆï¼Œè·å¾—åç«¯URL**ï¼š
   ```
   https://ä½ çš„é¡¹ç›®å.railway.app
   ```

### ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²å‰ç«¯åˆ°Vercel

1. **è®¿é—®Vercel.comå¹¶ç™»å½•**
2. **ç‚¹å‡»"New Project" â†’ "Import Git Repository"**
3. **é€‰æ‹©ä½ çš„ä»“åº“ï¼Œè®¾ç½®æ ¹ç›®å½•ä¸º `project`**
4. **é…ç½®ç¯å¢ƒå˜é‡**ï¼š
   ```env
   VITE_API_BASE_URL=https://ä½ çš„åç«¯åŸŸå.railway.app
   ```

5. **ç­‰å¾…éƒ¨ç½²å®Œæˆï¼Œè·å¾—å‰ç«¯URL**ï¼š
   ```
   https://ä½ çš„é¡¹ç›®å.vercel.app
   ```

### ç¬¬å››æ­¥ï¼šæ›´æ–°å‰ç«¯APIé…ç½®

ä¿®æ”¹ `project/src/config/api.ts`ï¼š
```typescript
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'https://ä½ çš„åç«¯åŸŸå.railway.app';

export const RUNNING_HUB_CONFIG = {
  // ... å…¶ä»–é…ç½®
  API_BASE_URL
};
```

---

## ğŸ’° æ–¹æ¡ˆäºŒï¼šäº‘æœåŠ¡å™¨éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### è´­ä¹°äº‘æœåŠ¡å™¨

#### é˜¿é‡Œäº‘ECS (æ¨è)
- **é…ç½®**: 2æ ¸4Gï¼Œ40G SSD
- **ç³»ç»Ÿ**: Ubuntu 20.04 LTS
- **æˆæœ¬**: çº¦80-120å…ƒ/æœˆ

#### è…¾è®¯äº‘CVM
- **é…ç½®**: 2æ ¸4Gï¼Œ50G SSD
- **ç³»ç»Ÿ**: Ubuntu 20.04 LTS
- **æˆæœ¬**: çº¦70-100å…ƒ/æœˆ

### æœåŠ¡å™¨åˆå§‹åŒ–

```bash
# è¿æ¥æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y

# å®‰è£…Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
apt-get install -y nodejs

# å®‰è£…PM2 (è¿›ç¨‹ç®¡ç†)
npm install -g pm2

# å®‰è£…Nginx (åå‘ä»£ç†)
apt install nginx -y

# å®‰è£…Git
apt install git -y
```

### éƒ¨ç½²ä»£ç 

```bash
# å…‹éš†ä»£ç 
cd /var/www
git clone https://github.com/ä½ çš„ç”¨æˆ·å/cosnap-project.git
cd cosnap-project

# éƒ¨ç½²åç«¯
cd runninghub-backend
npm install
# åˆ›å»º.envæ–‡ä»¶å¹¶å¡«å…¥é…ç½®
pm2 start src/index.js --name "cosnap-backend"

# éƒ¨ç½²å‰ç«¯
cd ../project
npm install
npm run build

# å¤åˆ¶æ„å»ºæ–‡ä»¶åˆ°Nginxç›®å½•
cp -r dist/* /var/www/html/
```

### é…ç½®Nginx

åˆ›å»º `/etc/nginx/sites-available/cosnap`ï¼š
```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸå.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }
    
    # åç«¯APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

å¯ç”¨ç«™ç‚¹ï¼š
```bash
ln -s /etc/nginx/sites-available/cosnap /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx
```

---

## ğŸŒ åŸŸåé…ç½®

### è´­ä¹°åŸŸå
- **å›½å†…**: é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€è¥¿æ•° (éœ€å¤‡æ¡ˆ)
- **å›½å¤–**: Namecheapã€GoDaddy (æ— éœ€å¤‡æ¡ˆ)
- **æˆæœ¬**: 50-100å…ƒ/å¹´

### é…ç½®DNSè§£æ

åœ¨åŸŸåç®¡ç†åå°æ·»åŠ Aè®°å½•ï¼š
```
ç±»å‹: A
åç§°: @
å€¼: ä½ çš„æœåŠ¡å™¨IPåœ°å€
TTL: 600
```

### SSLè¯ä¹¦é…ç½® (HTTPS)

```bash
# å®‰è£…Certbot
snap install --classic certbot

# è·å–SSLè¯ä¹¦
certbot --nginx -d ä½ çš„åŸŸå.com

# è‡ªåŠ¨ç»­æœŸ
crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

---

## ğŸ”§ è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

åˆ›å»º `deploy.sh`ï¼š
```bash
#!/bin/bash
echo "ğŸš€ å¼€å§‹éƒ¨ç½²Cosnapé¡¹ç›®..."

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# éƒ¨ç½²åç«¯
echo "ğŸ“¦ éƒ¨ç½²åç«¯..."
cd runninghub-backend
npm install
pm2 restart cosnap-backend

# éƒ¨ç½²å‰ç«¯
echo "ğŸ¨ éƒ¨ç½²å‰ç«¯..."
cd ../project
npm install
npm run build
cp -r dist/* /var/www/html/

echo "âœ… éƒ¨ç½²å®Œæˆï¼"
echo "ğŸŒ è®¿é—®åœ°å€: https://ä½ çš„åŸŸå.com"
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
chmod +x deploy.sh
./deploy.sh
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å‰ç«¯æ— æ³•è¿æ¥åç«¯API
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ: `pm2 status`
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®: `ufw status`
3. éªŒè¯APIåœ°å€é…ç½®æ˜¯å¦æ­£ç¡®

### Q2: å›¾ç‰‡ä¸Šä¼ å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥RunningHub APIå¯†é’¥æ˜¯å¦æ­£ç¡®
2. æŸ¥çœ‹åç«¯æ—¥å¿—: `pm2 logs cosnap-backend`
3. ç¡®è®¤äº‘å­˜å‚¨é…ç½® (å¤§æ–‡ä»¶ä¸Šä¼ )

### Q3: åŸŸåè®¿é—®404é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥DNSè§£ææ˜¯å¦ç”Ÿæ•ˆ: `nslookup ä½ çš„åŸŸå.com`
2. éªŒè¯Nginxé…ç½®: `nginx -t`
3. æ£€æŸ¥é˜²ç«å¢™80/443ç«¯å£

### Q4: HTTPSè¯ä¹¦é—®é¢˜
**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤åŸŸåDNSå·²ç”Ÿæ•ˆ
2. æ£€æŸ¥é˜²ç«å¢™å¼€æ”¾80/443ç«¯å£
3. é‡æ–°ç”³è¯·è¯ä¹¦: `certbot --nginx -d ä½ çš„åŸŸå.com`

### Q5: æ€§èƒ½ä¼˜åŒ–å»ºè®®
**ä¼˜åŒ–æ–¹æ¡ˆ**:
1. å¯ç”¨Nginx gzipå‹ç¼©
2. é…ç½®é™æ€èµ„æºç¼“å­˜
3. ä½¿ç”¨CDNåŠ é€Ÿ (å¯é€‰)
4. æ•°æ®åº“ä¼˜åŒ– (å¦‚éœ€è¦)

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸæ£€æŸ¥æ¸…å•

- [ ] åç«¯APIæ­£å¸¸å“åº”
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] AIæ•ˆæœå¤„ç†æ­£å¸¸
- [ ] HTTPSè¯ä¹¦æœ‰æ•ˆ
- [ ] åŸŸåè§£ææ­£ç¡®
- [ ] ç›‘æ§å’Œæ—¥å¿—é…ç½®

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœæ‚¨åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**: `pm2 logs cosnap-backend`
2. **æ£€æŸ¥çŠ¶æ€**: `pm2 status`
3. **é‡å¯æœåŠ¡**: `pm2 restart all`
4. **æŸ¥çœ‹Nginxé”™è¯¯**: `tail -f /var/log/nginx/error.log`

---

**ç¥æ‚¨éƒ¨ç½²æˆåŠŸï¼ğŸ‰**

ç°åœ¨æ‚¨çš„Cosnapé¡¹ç›®å·²ç»å¯ä»¥é€šè¿‡å…¬ç½‘è®¿é—®äº†ï¼