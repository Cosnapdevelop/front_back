# CosnapèƒŒæ™¯æ›¿æ¢ç‰¹æ•ˆ - æŠ€æœ¯å®ç°æ–‡æ¡£

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

CosnapèƒŒæ™¯æ›¿æ¢ç‰¹æ•ˆæ˜¯ä¸€ä¸ªåŸºäºAIçš„å›¾åƒå¤„ç†åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä¸Šä¼ åŸå§‹å›¾ç‰‡å’ŒèƒŒæ™¯å›¾ç‰‡ï¼Œé€šè¿‡RunningHub ComfyUI APIè‡ªåŠ¨ç”ŸæˆèƒŒæ™¯æ›¿æ¢åçš„å›¾ç‰‡ã€‚

## ğŸ”§ æŠ€æœ¯æ¶æ„

### å‰ç«¯ (React + TypeScript + Vite)
- **é¡µé¢**: `ApplyEffect.tsx` - ç‰¹æ•ˆåº”ç”¨é¡µé¢
- **Hook**: `useTaskProcessing.ts` - ä»»åŠ¡å¤„ç†é€»è¾‘
- **æœåŠ¡**: `runningHubApi.ts` - APIè°ƒç”¨æœåŠ¡
- **é…ç½®**: `api.ts` - ç¯å¢ƒé…ç½®

### åç«¯ (Node.js + Express)
- **è·¯ç”±**: `effects.js` - APIè·¯ç”±å¤„ç†
- **æœåŠ¡**: `comfyUITaskService.js` - ComfyUIä»»åŠ¡æœåŠ¡
- **é…ç½®**: ç¯å¢ƒå˜é‡ç®¡ç†

### å¤–éƒ¨æœåŠ¡
- **RunningHub ComfyUI API**: AIå›¾åƒå¤„ç†æœåŠ¡
- **APIåŸŸå**: `https://www.runninghub.ai` (å·²ä¿®å¤)

## ğŸ“‹ å®ç°ç»†èŠ‚

### 1. ç‰¹æ•ˆé…ç½®
```typescript
// project/src/data/mockData.ts
{
  id: 'cosnap-background-change',
  name: 'CosnapèƒŒæ™¯æ›¿æ¢',
  description: 'AIæ™ºèƒ½èƒŒæ™¯æ›¿æ¢ï¼Œè®©æ‚¨çš„ç…§ç‰‡ç„•ç„¶ä¸€æ–°',
  webappId: '1949831786093264897',
  parameters: [
    {
      id: 'originalImage',
      name: 'åŸå§‹å›¾ç‰‡',
      type: 'image',
      required: true,
      nodeInfoTemplate: { nodeId: '240', fieldName: 'image' }
    },
    {
      id: 'backgroundImage', 
      name: 'èƒŒæ™¯å›¾ç‰‡',
      type: 'image',
      required: true,
      nodeInfoTemplate: { nodeId: '284', fieldName: 'image' }
    }
  ]
}
```

### 2. å‰ç«¯UIå®ç°
- è‡ªå®šä¹‰å›¾ç‰‡ä¸Šä¼ ç»„ä»¶
- æ‹–æ‹½ä¸Šä¼ æ”¯æŒ
- å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
- é‡æ–°é€‰æ‹©æŒ‰é’®

### 3. APIè°ƒç”¨æµç¨‹

#### å‰ç«¯åˆ°åç«¯
```
POST /api/effects/comfyui/apply
Content-Type: multipart/form-data

FormData:
- images: [åŸå§‹å›¾ç‰‡æ–‡ä»¶, èƒŒæ™¯å›¾ç‰‡æ–‡ä»¶]
- webappId: "1949831786093264897"
- nodeInfoList: [
    { nodeId: "240", fieldName: "image", paramKey: "originalImage" },
    { nodeId: "284", fieldName: "image", paramKey: "backgroundImage" }
  ]
```

#### åç«¯åˆ°RunningHub
1. **å›¾ç‰‡ä¸Šä¼ **: `POST /upload/openapi/upload`
2. **ä»»åŠ¡åˆ›å»º**: `POST /task/openapi/create`
3. **çŠ¶æ€è½®è¯¢**: `POST /task/openapi/status`
4. **ç»“æœè·å–**: `POST /task/openapi/outputs`

## ğŸ”§ æœ€è¿‘ä¿®å¤çš„é—®é¢˜

### 1. APIåŸŸåä¿®å¤
**é—®é¢˜**: ä»£ç ä½¿ç”¨ `runninghub.cn`ï¼Œä½†APIæ–‡æ¡£æ˜¾ç¤º `runninghub.ai`
**ä¿®å¤**: æ›´æ–°æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨æ­£ç¡®çš„åŸŸå `https://www.runninghub.ai`

### 2. çŠ¶æ€æŸ¥è¯¢ä¿®å¤
**é—®é¢˜**: çŠ¶æ€æŸ¥è¯¢è¿”å›æ ¼å¼è§£æé”™è¯¯
**ä¿®å¤**: 
- çŠ¶æ€ç›´æ¥è¿”å›åœ¨ `response.data.data` å­—æ®µä¸­
- æ·»åŠ è¯¦ç»†çš„å“åº”æ—¥å¿—ç”¨äºè°ƒè¯•

### 3. ç»“æœè§£æä¿®å¤
**é—®é¢˜**: ç»“æœæ•°æ®è§£æé”™è¯¯
**ä¿®å¤**: 
- ç»“æœç›´æ¥è¿”å›åœ¨ `response.data.data` å­—æ®µä¸­ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„
- ä¼˜å…ˆä½¿ç”¨ `fileUrl` å­—æ®µè·å–å›¾ç‰‡URL

## ğŸ“ æ–‡ä»¶ç»“æ„

```
project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ ApplyEffect.tsx          # ç‰¹æ•ˆåº”ç”¨é¡µé¢
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useTaskProcessing.ts     # ä»»åŠ¡å¤„ç†Hook
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ runningHubApi.ts         # APIæœåŠ¡
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ api.ts                   # APIé…ç½®
â”‚   â”‚   â””â”€â”€ runningHub.ts            # RunningHubé…ç½®
â”‚   â””â”€â”€ data/
â”‚       â””â”€â”€ mockData.ts              # ç‰¹æ•ˆæ•°æ®
â””â”€â”€ README_BACKGROUND_CHANGE.md      # æœ¬æ–‡æ¡£

runninghub-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ effects.js               # APIè·¯ç”±
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ comfyUITaskService.js    # ComfyUIæœåŠ¡
â””â”€â”€ test-api.js                      # APIæµ‹è¯•è„šæœ¬
```

## ğŸ§ª æµ‹è¯•

### APIæµ‹è¯•è„šæœ¬
```bash
# æµ‹è¯•ç‰¹å®šä»»åŠ¡çš„çŠ¶æ€å’Œç»“æœ
cd runninghub-backend
node test-api.js <taskId>

# ç¤ºä¾‹
node test-api.js 1950170519231926274
```

### åŠŸèƒ½æµ‹è¯•
1. ä¸Šä¼ åŸå§‹å›¾ç‰‡å’ŒèƒŒæ™¯å›¾ç‰‡
2. ç‚¹å‡»"å¼€å§‹èƒŒæ™¯æ›¿æ¢"
3. ç­‰å¾…å¤„ç†å®Œæˆ
4. æŸ¥çœ‹ç”Ÿæˆçš„å›¾ç‰‡

## ğŸ› å¸¸è§é—®é¢˜

### 1. ä»»åŠ¡çŠ¶æ€ä¸€ç›´pending
**åŸå› **: APIåŸŸåæˆ–çŠ¶æ€è§£æé”™è¯¯
**è§£å†³**: 
- ç¡®è®¤ä½¿ç”¨æ­£ç¡®çš„APIåŸŸå `https://www.runninghub.ai`
- æ£€æŸ¥çŠ¶æ€æŸ¥è¯¢çš„å“åº”æ ¼å¼
- ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯APIè°ƒç”¨

### 2. å›¾ç‰‡ä¸Šä¼ å¤±è´¥
**åŸå› **: API Keyæ— æ•ˆæˆ–é…é¢ä¸è¶³
**è§£å†³**: 
- æ£€æŸ¥RunningHub API Keyæ˜¯å¦æ­£ç¡®
- ç¡®è®¤APIé…é¢æ˜¯å¦å……è¶³

### 3. ç»“æœè·å–å¤±è´¥
**åŸå› **: ä»»åŠ¡æœªå®Œæˆæˆ–ç»“æœè§£æé”™è¯¯
**è§£å†³**: 
- ç­‰å¾…ä»»åŠ¡å®Œæˆï¼ˆé€šå¸¸éœ€è¦1-3åˆ†é’Ÿï¼‰
- æ£€æŸ¥ç»“æœAPIçš„å“åº”æ ¼å¼

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. è½®è¯¢ä¼˜åŒ–
- åˆå§‹é—´éš”: 2ç§’
- æœ€å¤§å°è¯•æ¬¡æ•°: 150æ¬¡ï¼ˆ5åˆ†é’Ÿï¼‰
- æŒ‡æ•°é€€é¿ç­–ç•¥

### 2. é”™è¯¯å¤„ç†
- ç½‘ç»œé”™è¯¯é‡è¯•
- è¶…æ—¶å¤„ç†
- è¯¦ç»†é”™è¯¯æ—¥å¿—

### 3. ç”¨æˆ·ä½“éªŒ
- å®æ—¶è¿›åº¦æ˜¾ç¤º
- é”™è¯¯æç¤º
- åŠ è½½çŠ¶æ€ç®¡ç†

## ğŸ”® æœªæ¥æ”¹è¿›

1. **WebSocketæ”¯æŒ**: ä½¿ç”¨WebSocketå®æ—¶è·å–ä»»åŠ¡çŠ¶æ€
2. **æ‰¹é‡å¤„ç†**: æ”¯æŒå¤šå¼ å›¾ç‰‡æ‰¹é‡å¤„ç†
3. **ç»“æœç¼“å­˜**: ç¼“å­˜å¤„ç†ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
4. **è¿›åº¦æ¡**: æ˜¾ç¤ºè¯¦ç»†çš„å¤„ç†è¿›åº¦
5. **é”™è¯¯æ¢å¤**: è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. æ£€æŸ¥åç«¯æ—¥å¿—
3. ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯API
4. æŸ¥çœ‹RunningHubæ§åˆ¶å°çš„ä»»åŠ¡çŠ¶æ€